.include "macros.inc"

.section .sdata, "wa"
.balign 0x8
l_byOffsetCounter$661:
	.byte 0x80

.section .sbss, "wa"
.balign 0x8
__DBMtrCallback:
	.skip 0x4
__DBDbgCallback:
	.skip 0x4
__DBEXIInputFlag:
	.skip 0x4
__DBRecvMail:
	.skip 0x4
__DBRecvDataSize:
	.skip 0x8

.section .text, "ax"
.global __DBMtrHandler
__DBMtrHandler:
/* 800C6810 000C1710  81 8D 9A 10 */	lwz r12, __DBMtrCallback-_SDA_BASE_(r13)
/* 800C6814 000C1714  38 00 00 01 */	li r0, 1
/* 800C6818 000C1718  98 0D 9A 18 */	stb r0, __DBEXIInputFlag-_SDA_BASE_(r13)
/* 800C681C 000C171C  2C 0C 00 00 */	cmpwi r12, 0
/* 800C6820 000C1720  4D 82 00 20 */	beqlr 
/* 800C6824 000C1724  38 60 00 00 */	li r3, 0
/* 800C6828 000C1728  7D 89 03 A6 */	mtctr r12
/* 800C682C 000C172C  4E 80 04 20 */	bctr 
/* 800C6830 000C1730  4E 80 00 20 */	blr 

.global __DBIntrHandler
__DBIntrHandler:
/* 800C6834 000C1734  38 00 10 00 */	li r0, 0x1000
/* 800C6838 000C1738  3C A0 CC 00 */	lis r5, 0xCC003000@ha
/* 800C683C 000C173C  90 05 30 00 */	stw r0, 0xCC003000@l(r5)
/* 800C6840 000C1740  81 8D 9A 14 */	lwz r12, __DBDbgCallback-_SDA_BASE_(r13)
/* 800C6844 000C1744  2C 0C 00 00 */	cmpwi r12, 0
/* 800C6848 000C1748  4D 82 00 20 */	beqlr 
/* 800C684C 000C174C  7D 89 03 A6 */	mtctr r12
/* 800C6850 000C1750  4E 80 04 20 */	bctr 
/* 800C6854 000C1754  4E 80 00 20 */	blr 

.global DBInitComm
DBInitComm:
/* 800C6858 000C1758  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800C685C 000C175C  7C 08 02 A6 */	mflr r0
/* 800C6860 000C1760  90 01 00 24 */	stw r0, 0x24(r1)
/* 800C6864 000C1764  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800C6868 000C1768  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800C686C 000C176C  7C 9E 23 78 */	mr r30, r4
/* 800C6870 000C1770  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800C6874 000C1774  7C 7D 1B 78 */	mr r29, r3
/* 800C6878 000C1778  48 02 B0 49 */	bl OSDisableInterrupts
/* 800C687C 000C177C  38 0D 9A 18 */	addi r0, r13, __DBEXIInputFlag-_SDA_BASE_
/* 800C6880 000C1780  7C 7F 1B 78 */	mr r31, r3
/* 800C6884 000C1784  90 1D 00 00 */	stw r0, 0(r29)
/* 800C6888 000C1788  93 CD 9A 10 */	stw r30, __DBMtrCallback-_SDA_BASE_(r13)
/* 800C688C 000C178C  48 00 05 A1 */	bl __DBEXIInit
/* 800C6890 000C1790  7F E3 FB 78 */	mr r3, r31
/* 800C6894 000C1794  48 02 B0 55 */	bl OSRestoreInterrupts
/* 800C6898 000C1798  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800C689C 000C179C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800C68A0 000C17A0  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800C68A4 000C17A4  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800C68A8 000C17A8  7C 08 03 A6 */	mtlr r0
/* 800C68AC 000C17AC  38 21 00 20 */	addi r1, r1, 0x20
/* 800C68B0 000C17B0  4E 80 00 20 */	blr 

.global DBInitInterrupts
DBInitInterrupts:
/* 800C68B4 000C17B4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800C68B8 000C17B8  7C 08 02 A6 */	mflr r0
/* 800C68BC 000C17BC  3C 60 00 02 */	lis r3, 0x00018000@ha
/* 800C68C0 000C17C0  90 01 00 14 */	stw r0, 0x14(r1)
/* 800C68C4 000C17C4  38 63 80 00 */	addi r3, r3, 0x00018000@l
/* 800C68C8 000C17C8  48 02 B3 89 */	bl __OSMaskInterrupts
/* 800C68CC 000C17CC  38 60 00 40 */	li r3, 0x40
/* 800C68D0 000C17D0  48 02 B3 81 */	bl __OSMaskInterrupts
/* 800C68D4 000C17D4  3C 60 80 0C */	lis r3, __DBMtrHandler@ha
/* 800C68D8 000C17D8  3C 80 80 0C */	lis r4, __DBIntrHandler@ha
/* 800C68DC 000C17DC  38 63 68 10 */	addi r3, r3, __DBMtrHandler@l
/* 800C68E0 000C17E0  90 6D 9A 14 */	stw r3, __DBDbgCallback-_SDA_BASE_(r13)
/* 800C68E4 000C17E4  38 84 68 34 */	addi r4, r4, __DBIntrHandler@l
/* 800C68E8 000C17E8  38 60 00 19 */	li r3, 0x19
/* 800C68EC 000C17EC  48 02 B0 21 */	bl __OSSetInterruptHandler
/* 800C68F0 000C17F0  38 60 00 40 */	li r3, 0x40
/* 800C68F4 000C17F4  48 02 B3 DD */	bl __OSUnmaskInterrupts
/* 800C68F8 000C17F8  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800C68FC 000C17FC  7C 08 03 A6 */	mtlr r0
/* 800C6900 000C1800  38 21 00 10 */	addi r1, r1, 0x10
/* 800C6904 000C1804  4E 80 00 20 */	blr 

.global DBQueryData
DBQueryData:
/* 800C6908 000C1808  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800C690C 000C180C  7C 08 02 A6 */	mflr r0
/* 800C6910 000C1810  38 60 00 00 */	li r3, 0
/* 800C6914 000C1814  90 01 00 24 */	stw r0, 0x24(r1)
/* 800C6918 000C1818  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800C691C 000C181C  80 0D 9A 20 */	lwz r0, __DBRecvDataSize-_SDA_BASE_(r13)
/* 800C6920 000C1820  98 6D 9A 18 */	stb r3, __DBEXIInputFlag-_SDA_BASE_(r13)
/* 800C6924 000C1824  2C 00 00 00 */	cmpwi r0, 0
/* 800C6928 000C1828  40 82 00 6C */	bne lbl_800C6994
/* 800C692C 000C182C  48 02 AF 95 */	bl OSDisableInterrupts
/* 800C6930 000C1830  7C 7F 1B 78 */	mr r31, r3
/* 800C6934 000C1834  38 81 00 08 */	addi r4, r1, 8
/* 800C6938 000C1838  3C 60 34 00 */	lis r3, 0x3400
/* 800C693C 000C183C  38 A0 00 01 */	li r5, 1
/* 800C6940 000C1840  48 00 05 A9 */	bl __DBEXIReadReg
/* 800C6944 000C1844  88 01 00 08 */	lbz r0, 8(r1)
/* 800C6948 000C1848  54 00 07 39 */	rlwinm. r0, r0, 0, 0x1c, 0x1c
/* 800C694C 000C184C  40 82 00 40 */	bne lbl_800C698C
/* 800C6950 000C1850  3C 60 34 00 */	lis r3, 0x34000200@ha
/* 800C6954 000C1854  38 81 00 0C */	addi r4, r1, 0xc
/* 800C6958 000C1858  38 63 02 00 */	addi r3, r3, 0x34000200@l
/* 800C695C 000C185C  38 A0 00 04 */	li r5, 4
/* 800C6960 000C1860  48 00 05 89 */	bl __DBEXIReadReg
/* 800C6964 000C1864  80 81 00 0C */	lwz r4, 0xc(r1)
/* 800C6968 000C1868  54 83 00 CE */	rlwinm r3, r4, 0, 3, 7
/* 800C696C 000C186C  3C 03 E1 00 */	addis r0, r3, 0xe100
/* 800C6970 000C1870  28 00 00 00 */	cmplwi r0, 0
/* 800C6974 000C1874  40 82 00 18 */	bne lbl_800C698C
/* 800C6978 000C1878  54 83 04 FE */	clrlwi r3, r4, 0x13
/* 800C697C 000C187C  38 00 00 01 */	li r0, 1
/* 800C6980 000C1880  90 8D 9A 1C */	stw r4, __DBRecvMail-_SDA_BASE_(r13)
/* 800C6984 000C1884  90 6D 9A 20 */	stw r3, __DBRecvDataSize-_SDA_BASE_(r13)
/* 800C6988 000C1888  98 0D 9A 18 */	stb r0, __DBEXIInputFlag-_SDA_BASE_(r13)
lbl_800C698C:
/* 800C698C 000C188C  7F E3 FB 78 */	mr r3, r31
/* 800C6990 000C1890  48 02 AF 59 */	bl OSRestoreInterrupts
lbl_800C6994:
/* 800C6994 000C1894  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800C6998 000C1898  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800C699C 000C189C  80 6D 9A 20 */	lwz r3, __DBRecvDataSize-_SDA_BASE_(r13)
/* 800C69A0 000C18A0  7C 08 03 A6 */	mtlr r0
/* 800C69A4 000C18A4  38 21 00 20 */	addi r1, r1, 0x20
/* 800C69A8 000C18A8  4E 80 00 20 */	blr 

.global DBRead
DBRead:
/* 800C69AC 000C18AC  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800C69B0 000C18B0  7C 08 02 A6 */	mflr r0
/* 800C69B4 000C18B4  90 01 00 14 */	stw r0, 0x14(r1)
/* 800C69B8 000C18B8  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800C69BC 000C18BC  7C 9F 23 78 */	mr r31, r4
/* 800C69C0 000C18C0  93 C1 00 08 */	stw r30, 8(r1)
/* 800C69C4 000C18C4  7C 7E 1B 78 */	mr r30, r3
/* 800C69C8 000C18C8  48 02 AE F9 */	bl OSDisableInterrupts
/* 800C69CC 000C18CC  80 AD 9A 1C */	lwz r5, __DBRecvMail-_SDA_BASE_(r13)
/* 800C69D0 000C18D0  38 1F 00 03 */	addi r0, r31, 3
/* 800C69D4 000C18D4  7C 7F 1B 78 */	mr r31, r3
/* 800C69D8 000C18D8  7F C4 F3 78 */	mr r4, r30
/* 800C69DC 000C18DC  54 A3 87 FE */	rlwinm r3, r5, 0x10, 0x1f, 0x1f
/* 800C69E0 000C18E0  54 05 00 3A */	rlwinm r5, r0, 0, 0, 0x1d
/* 800C69E4 000C18E4  7C 03 00 D0 */	neg r0, r3
/* 800C69E8 000C18E8  54 03 05 28 */	rlwinm r3, r0, 0, 0x14, 0x14
/* 800C69EC 000C18EC  3C 63 00 D1 */	addis r3, r3, 0xd1
/* 800C69F0 000C18F0  38 03 10 00 */	addi r0, r3, 0x1000
/* 800C69F4 000C18F4  54 03 30 AE */	rlwinm r3, r0, 6, 2, 0x17
/* 800C69F8 000C18F8  48 00 07 19 */	bl __DBEXIReadRam
/* 800C69FC 000C18FC  38 00 00 00 */	li r0, 0
/* 800C6A00 000C1900  7F E3 FB 78 */	mr r3, r31
/* 800C6A04 000C1904  90 0D 9A 20 */	stw r0, __DBRecvDataSize-_SDA_BASE_(r13)
/* 800C6A08 000C1908  98 0D 9A 18 */	stb r0, __DBEXIInputFlag-_SDA_BASE_(r13)
/* 800C6A0C 000C190C  48 02 AE DD */	bl OSRestoreInterrupts
/* 800C6A10 000C1910  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800C6A14 000C1914  38 60 00 00 */	li r3, 0
/* 800C6A18 000C1918  83 C1 00 08 */	lwz r30, 8(r1)
/* 800C6A1C 000C191C  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800C6A20 000C1920  7C 08 03 A6 */	mtlr r0
/* 800C6A24 000C1924  38 21 00 10 */	addi r1, r1, 0x10
/* 800C6A28 000C1928  4E 80 00 20 */	blr 

.global DBWrite
DBWrite:
/* 800C6A2C 000C192C  94 21 FF D0 */	stwu r1, -0x30(r1)
/* 800C6A30 000C1930  7C 08 02 A6 */	mflr r0
/* 800C6A34 000C1934  90 01 00 34 */	stw r0, 0x34(r1)
/* 800C6A38 000C1938  39 61 00 30 */	addi r11, r1, 0x30
/* 800C6A3C 000C193C  4B FE B3 09 */	bl _savegpr_27
/* 800C6A40 000C1940  7C 7B 1B 78 */	mr r27, r3
/* 800C6A44 000C1944  7C 9C 23 78 */	mr r28, r4
/* 800C6A48 000C1948  48 02 AE 79 */	bl OSDisableInterrupts
/* 800C6A4C 000C194C  7C 7F 1B 78 */	mr r31, r3
lbl_800C6A50:
/* 800C6A50 000C1950  38 81 00 0A */	addi r4, r1, 0xa
/* 800C6A54 000C1954  3C 60 34 00 */	lis r3, 0x3400
/* 800C6A58 000C1958  38 A0 00 01 */	li r5, 1
/* 800C6A5C 000C195C  48 00 04 8D */	bl __DBEXIReadReg
/* 800C6A60 000C1960  88 01 00 0A */	lbz r0, 0xa(r1)
/* 800C6A64 000C1964  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800C6A68 000C1968  40 82 FF E8 */	bne lbl_800C6A50
/* 800C6A6C 000C196C  88 6D 81 D8 */	lbz r3, l_byOffsetCounter$661-_SDA_BASE_(r13)
/* 800C6A70 000C1970  38 1C 00 03 */	addi r0, r28, 3
/* 800C6A74 000C1974  54 1D 00 3A */	rlwinm r29, r0, 0, 0, 0x1d
/* 800C6A78 000C1978  38 63 00 01 */	addi r3, r3, 1
/* 800C6A7C 000C197C  54 60 07 FE */	clrlwi r0, r3, 0x1f
/* 800C6A80 000C1980  98 6D 81 D8 */	stb r3, l_byOffsetCounter$661-_SDA_BASE_(r13)
/* 800C6A84 000C1984  7C 00 00 D0 */	neg r0, r0
/* 800C6A88 000C1988  54 03 05 28 */	rlwinm r3, r0, 0, 0x14, 0x14
/* 800C6A8C 000C198C  3C 03 00 D1 */	addis r0, r3, 0xd1
/* 800C6A90 000C1990  54 00 30 AE */	rlwinm r0, r0, 6, 2, 0x17
/* 800C6A94 000C1994  64 1E 80 00 */	oris r30, r0, 0x8000
lbl_800C6A98:
/* 800C6A98 000C1998  7F C3 F3 78 */	mr r3, r30
/* 800C6A9C 000C199C  7F 64 DB 78 */	mr r4, r27
/* 800C6AA0 000C19A0  7F A5 EB 78 */	mr r5, r29
/* 800C6AA4 000C19A4  48 00 07 4D */	bl __DBEXIWriteRam
/* 800C6AA8 000C19A8  2C 03 00 00 */	cmpwi r3, 0
/* 800C6AAC 000C19AC  41 82 FF EC */	beq lbl_800C6A98
lbl_800C6AB0:
/* 800C6AB0 000C19B0  38 81 00 09 */	addi r4, r1, 9
/* 800C6AB4 000C19B4  3C 60 34 00 */	lis r3, 0x3400
/* 800C6AB8 000C19B8  38 A0 00 01 */	li r5, 1
/* 800C6ABC 000C19BC  48 00 04 2D */	bl __DBEXIReadReg
/* 800C6AC0 000C19C0  88 01 00 09 */	lbz r0, 9(r1)
/* 800C6AC4 000C19C4  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800C6AC8 000C19C8  40 82 FF E8 */	bne lbl_800C6AB0
/* 800C6ACC 000C19CC  88 6D 81 D8 */	lbz r3, l_byOffsetCounter$661-_SDA_BASE_(r13)
/* 800C6AD0 000C19D0  57 80 04 FE */	clrlwi r0, r28, 0x13
/* 800C6AD4 000C19D4  64 1D 1F 00 */	oris r29, r0, 0x1f00
/* 800C6AD8 000C19D8  3F C0 B4 00 */	lis r30, 0xB4000100@ha
/* 800C6ADC 000C19DC  50 7D 82 1E */	rlwimi r29, r3, 0x10, 8, 0xf
lbl_800C6AE0:
/* 800C6AE0 000C19E0  93 A1 00 0C */	stw r29, 0xc(r1)
/* 800C6AE4 000C19E4  38 7E 01 00 */	addi r3, r30, 0xB4000100@l
/* 800C6AE8 000C19E8  38 81 00 0C */	addi r4, r1, 0xc
/* 800C6AEC 000C19EC  38 A0 00 04 */	li r5, 4
/* 800C6AF0 000C19F0  48 00 05 1D */	bl __DBEXIWriteReg
/* 800C6AF4 000C19F4  2C 03 00 00 */	cmpwi r3, 0
/* 800C6AF8 000C19F8  41 82 FF E8 */	beq lbl_800C6AE0
lbl_800C6AFC:
/* 800C6AFC 000C19FC  38 81 00 08 */	addi r4, r1, 8
/* 800C6B00 000C1A00  3C 60 34 00 */	lis r3, 0x3400
/* 800C6B04 000C1A04  38 A0 00 01 */	li r5, 1
/* 800C6B08 000C1A08  48 00 03 E1 */	bl __DBEXIReadReg
/* 800C6B0C 000C1A0C  88 01 00 08 */	lbz r0, 8(r1)
/* 800C6B10 000C1A10  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 800C6B14 000C1A14  40 82 FF E8 */	bne lbl_800C6AFC
/* 800C6B18 000C1A18  7F E3 FB 78 */	mr r3, r31
/* 800C6B1C 000C1A1C  48 02 AD CD */	bl OSRestoreInterrupts
/* 800C6B20 000C1A20  39 61 00 30 */	addi r11, r1, 0x30
/* 800C6B24 000C1A24  38 60 00 00 */	li r3, 0
/* 800C6B28 000C1A28  4B FE B2 69 */	bl _restgpr_27
/* 800C6B2C 000C1A2C  80 01 00 34 */	lwz r0, 0x34(r1)
/* 800C6B30 000C1A30  7C 08 03 A6 */	mtlr r0
/* 800C6B34 000C1A34  38 21 00 30 */	addi r1, r1, 0x30
/* 800C6B38 000C1A38  4E 80 00 20 */	blr 

.global DBOpen
DBOpen:
/* 800C6B3C 000C1A3C  4E 80 00 20 */	blr 

.global DBClose
DBClose:
/* 800C6B40 000C1A40  4E 80 00 20 */	blr 
