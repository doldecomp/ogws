.include "macros.inc"

.section .text, "ax"

.global fclose
fclose:
/* 800B47A0 000AF6A0  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800B47A4 000AF6A4  7C 08 02 A6 */	mflr r0
/* 800B47A8 000AF6A8  2C 03 00 00 */	cmpwi r3, 0
/* 800B47AC 000AF6AC  90 01 00 24 */	stw r0, 0x24(r1)
/* 800B47B0 000AF6B0  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800B47B4 000AF6B4  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800B47B8 000AF6B8  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800B47BC 000AF6BC  7C 7D 1B 78 */	mr r29, r3
/* 800B47C0 000AF6C0  40 82 00 0C */	bne lbl_800B47CC
/* 800B47C4 000AF6C4  38 60 FF FF */	li r3, -1
/* 800B47C8 000AF6C8  48 00 00 78 */	b lbl_800B4840
lbl_800B47CC:
/* 800B47CC 000AF6CC  80 03 00 04 */	lwz r0, 4(r3)
/* 800B47D0 000AF6D0  54 00 57 7F */	rlwinm. r0, r0, 0xa, 0x1d, 0x1f
/* 800B47D4 000AF6D4  40 82 00 0C */	bne lbl_800B47E0
/* 800B47D8 000AF6D8  38 60 00 00 */	li r3, 0
/* 800B47DC 000AF6DC  48 00 00 64 */	b lbl_800B4840
lbl_800B47E0:
/* 800B47E0 000AF6E0  48 00 00 7D */	bl fflush
/* 800B47E4 000AF6E4  81 9D 00 44 */	lwz r12, 0x44(r29)
/* 800B47E8 000AF6E8  7C 7E 1B 78 */	mr r30, r3
/* 800B47EC 000AF6EC  80 7D 00 00 */	lwz r3, 0(r29)
/* 800B47F0 000AF6F0  7D 89 03 A6 */	mtctr r12
/* 800B47F4 000AF6F4  4E 80 04 21 */	bctrl 
/* 800B47F8 000AF6F8  80 1D 00 08 */	lwz r0, 8(r29)
/* 800B47FC 000AF6FC  38 A0 00 00 */	li r5, 0
/* 800B4800 000AF700  80 9D 00 04 */	lwz r4, 4(r29)
/* 800B4804 000AF704  7C 7F 1B 78 */	mr r31, r3
/* 800B4808 000AF708  54 00 27 FF */	rlwinm. r0, r0, 4, 0x1f, 0x1f
/* 800B480C 000AF70C  90 BD 00 00 */	stw r5, 0(r29)
/* 800B4810 000AF710  54 84 02 8C */	rlwinm r4, r4, 0, 0xa, 6
/* 800B4814 000AF714  90 9D 00 04 */	stw r4, 4(r29)
/* 800B4818 000AF718  41 82 00 0C */	beq lbl_800B4824
/* 800B481C 000AF71C  80 7D 00 1C */	lwz r3, 0x1c(r29)
/* 800B4820 000AF720  4B FF DF D9 */	bl free
lbl_800B4824:
/* 800B4824 000AF724  2C 1E 00 00 */	cmpwi r30, 0
/* 800B4828 000AF728  38 00 00 00 */	li r0, 0
/* 800B482C 000AF72C  40 82 00 0C */	bne lbl_800B4838
/* 800B4830 000AF730  2C 1F 00 00 */	cmpwi r31, 0
/* 800B4834 000AF734  41 82 00 08 */	beq lbl_800B483C
lbl_800B4838:
/* 800B4838 000AF738  38 00 00 01 */	li r0, 1
lbl_800B483C:
/* 800B483C 000AF73C  7C 60 00 D0 */	neg r3, r0
lbl_800B4840:
/* 800B4840 000AF740  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800B4844 000AF744  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800B4848 000AF748  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800B484C 000AF74C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800B4850 000AF750  7C 08 03 A6 */	mtlr r0
/* 800B4854 000AF754  38 21 00 20 */	addi r1, r1, 0x20
/* 800B4858 000AF758  4E 80 00 20 */	blr 

.global fflush
fflush:
/* 800B485C 000AF75C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 800B4860 000AF760  7C 08 02 A6 */	mflr r0
/* 800B4864 000AF764  2C 03 00 00 */	cmpwi r3, 0
/* 800B4868 000AF768  90 01 00 14 */	stw r0, 0x14(r1)
/* 800B486C 000AF76C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 800B4870 000AF770  7C 7F 1B 78 */	mr r31, r3
/* 800B4874 000AF774  93 C1 00 08 */	stw r30, 8(r1)
/* 800B4878 000AF778  40 82 00 0C */	bne lbl_800B4884
/* 800B487C 000AF77C  4B FF E1 51 */	bl __flush_all
/* 800B4880 000AF780  48 00 00 F8 */	b lbl_800B4978
lbl_800B4884:
/* 800B4884 000AF784  88 03 00 0A */	lbz r0, 0xa(r3)
/* 800B4888 000AF788  2C 00 00 00 */	cmpwi r0, 0
/* 800B488C 000AF78C  40 82 00 10 */	bne lbl_800B489C
/* 800B4890 000AF790  80 83 00 04 */	lwz r4, 4(r3)
/* 800B4894 000AF794  54 80 57 7F */	rlwinm. r0, r4, 0xa, 0x1d, 0x1f
/* 800B4898 000AF798  40 82 00 0C */	bne lbl_800B48A4
lbl_800B489C:
/* 800B489C 000AF79C  38 60 FF FF */	li r3, -1
/* 800B48A0 000AF7A0  48 00 00 D8 */	b lbl_800B4978
lbl_800B48A4:
/* 800B48A4 000AF7A4  54 80 2F 7E */	rlwinm r0, r4, 5, 0x1d, 0x1f
/* 800B48A8 000AF7A8  28 00 00 01 */	cmplwi r0, 1
/* 800B48AC 000AF7AC  40 82 00 0C */	bne lbl_800B48B8
/* 800B48B0 000AF7B0  38 60 00 00 */	li r3, 0
/* 800B48B4 000AF7B4  48 00 00 C4 */	b lbl_800B4978
lbl_800B48B8:
/* 800B48B8 000AF7B8  80 83 00 08 */	lwz r4, 8(r3)
/* 800B48BC 000AF7BC  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 800B48C0 000AF7C0  28 00 00 03 */	cmplwi r0, 3
/* 800B48C4 000AF7C4  41 80 00 10 */	blt lbl_800B48D4
/* 800B48C8 000AF7C8  38 00 00 02 */	li r0, 2
/* 800B48CC 000AF7CC  50 04 E8 04 */	rlwimi r4, r0, 0x1d, 0, 2
/* 800B48D0 000AF7D0  90 83 00 08 */	stw r4, 8(r3)
lbl_800B48D4:
/* 800B48D4 000AF7D4  80 03 00 08 */	lwz r0, 8(r3)
/* 800B48D8 000AF7D8  54 00 1F 7E */	srwi r0, r0, 0x1d
/* 800B48DC 000AF7DC  28 00 00 02 */	cmplwi r0, 2
/* 800B48E0 000AF7E0  40 82 00 0C */	bne lbl_800B48EC
/* 800B48E4 000AF7E4  38 00 00 00 */	li r0, 0
/* 800B48E8 000AF7E8  90 03 00 28 */	stw r0, 0x28(r3)
lbl_800B48EC:
/* 800B48EC 000AF7EC  80 83 00 08 */	lwz r4, 8(r3)
/* 800B48F0 000AF7F0  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 800B48F4 000AF7F4  28 00 00 01 */	cmplwi r0, 1
/* 800B48F8 000AF7F8  41 82 00 14 */	beq lbl_800B490C
/* 800B48FC 000AF7FC  54 80 00 FE */	clrlwi r0, r4, 3
/* 800B4900 000AF800  90 03 00 08 */	stw r0, 8(r3)
/* 800B4904 000AF804  38 60 00 00 */	li r3, 0
/* 800B4908 000AF808  48 00 00 70 */	b lbl_800B4978
lbl_800B490C:
/* 800B490C 000AF80C  80 03 00 04 */	lwz r0, 4(r3)
/* 800B4910 000AF810  54 00 57 7E */	rlwinm r0, r0, 0xa, 0x1d, 0x1f
/* 800B4914 000AF814  28 00 00 01 */	cmplwi r0, 1
/* 800B4918 000AF818  41 82 00 0C */	beq lbl_800B4924
/* 800B491C 000AF81C  3B C0 00 00 */	li r30, 0
/* 800B4920 000AF820  48 00 00 10 */	b lbl_800B4930
lbl_800B4924:
/* 800B4924 000AF824  7F E3 FB 78 */	mr r3, r31
/* 800B4928 000AF828  48 00 01 11 */	bl ftell
/* 800B492C 000AF82C  7C 7E 1B 78 */	mr r30, r3
lbl_800B4930:
/* 800B4930 000AF830  7F E3 FB 78 */	mr r3, r31
/* 800B4934 000AF834  38 80 00 00 */	li r4, 0
/* 800B4938 000AF838  4B FF FA A9 */	bl __flush_buffer
/* 800B493C 000AF83C  2C 03 00 00 */	cmpwi r3, 0
/* 800B4940 000AF840  41 82 00 1C */	beq lbl_800B495C
/* 800B4944 000AF844  38 60 00 01 */	li r3, 1
/* 800B4948 000AF848  38 00 00 00 */	li r0, 0
/* 800B494C 000AF84C  98 7F 00 0A */	stb r3, 0xa(r31)
/* 800B4950 000AF850  38 60 FF FF */	li r3, -1
/* 800B4954 000AF854  90 1F 00 28 */	stw r0, 0x28(r31)
/* 800B4958 000AF858  48 00 00 20 */	b lbl_800B4978
lbl_800B495C:
/* 800B495C 000AF85C  80 1F 00 08 */	lwz r0, 8(r31)
/* 800B4960 000AF860  38 80 00 00 */	li r4, 0
/* 800B4964 000AF864  93 DF 00 18 */	stw r30, 0x18(r31)
/* 800B4968 000AF868  38 60 00 00 */	li r3, 0
/* 800B496C 000AF86C  54 00 00 FE */	clrlwi r0, r0, 3
/* 800B4970 000AF870  90 1F 00 08 */	stw r0, 8(r31)
/* 800B4974 000AF874  90 9F 00 28 */	stw r4, 0x28(r31)
lbl_800B4978:
/* 800B4978 000AF878  80 01 00 14 */	lwz r0, 0x14(r1)
/* 800B497C 000AF87C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 800B4980 000AF880  83 C1 00 08 */	lwz r30, 8(r1)
/* 800B4984 000AF884  7C 08 03 A6 */	mtlr r0
/* 800B4988 000AF888  38 21 00 10 */	addi r1, r1, 0x10
/* 800B498C 000AF88C  4E 80 00 20 */	blr 
